<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1" />
  <title>EchoLogz — History</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">EL</div>
        <div>
          <div class="title">EchoLogz</div>
          <div class="muted">History / Saved Comparisons</div>
        </div>
      </div>
      <div class="controls">
        <button class="btn">Dashboard</button>
        <button class="btn">New Compare</button>
        <button class="btn primary">Export CSV</button>
      </div>
    </div>

    <div class="panel">
      <div class="filters">
        <input id="q" class="input" placeholder="Search user, tag,
          playlist…" />
        <select id="status">
          <option value="">All Status</option>
          <option value="ok">Complete</option>
          <option value="warn">Partial</option>
          <option value="err">Failed</option>
        </select>
        <input id="from" type="date" class="input" />
        <input id="to" type="date" class="input" />
      </div>

      <div class="chips" id="chips">
        <div class="chip active" data-chip="all">All</div>
        <div class="chip" data-chip="me">Me vs Others</div>
        <div class="chip" data-chip="group">Group</div>
        <div class="chip" data-chip="playlist">Playlist vs Playlist</div>
        <div class="chip" data-chip="high">Score ≥ 0.75</div>
      </div>

      <div id="tableWrap" class="panel" style="padding:0; margin-top:
        16px;">
        <table class="table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Participants</th>
              <th>Type</th>
              <th>Score</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>

        <div id="empty" class="empty" style="display:none;">
          No results match your filters.
        </div>

        <div class="footer">
          <div id="count" class="muted">0 results</div>
          <div class="pager">
            <button class="btn" id="prev">Prev</button>
            <button class="btn" id="next">Next</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Drawer / details mock -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <h3>Compare Details</h3>
    <div class="muted" id="pairId">Pair #—</div>
    <div class="divider"></div>
    <div class="kv"><span>Date:</span> <strong id="dDate">—</strong></div>
    <div class="kv"><span>Participants:</span>
      <strong id="dUsers">—</strong></div>
    <div class="kv"><span>Type:</span> <strong id="dType">—</strong></div>
    <div class="kv"><span>Score:</span> <strong id="dScore">—</strong></div>
    <div class="kv"><span>Status:</span>
      <strong id="dStatus">—</strong></div>
    <div class="divider"></div>
    <div class="kv"><span>Top shared genres:</span>
      <strong>Indie, Alt Rock, Chill</strong></div>
    <div class="kv"><span>Notes:</span>
      <strong>Sample of 100 tracks per user</strong></div>
    <div class="divider"></div>
    <div class="actions">
      <button class="mini view">Open Heatmap</button>
      <button class="mini rerun">Re-run</button>
      <button class="mini del">Delete</button>
      <button id="closeDrawer" class="mini">Close</button>
    </div>
  </aside>

  <script>
    // --- Mock data ---------------------------------------------------
    const mock = [
      { id: 3012, date: "2025-03-12", users: ["Karis", "Sam"],
        type: "Me vs User", score: 0.78, status: "ok" },
      { id: 3009, date: "2025-03-10", users: ["Karis", "Ava"],
        type: "Me vs User", score: 0.64, status: "warn" },
      { id: 2988, date: "2025-03-05", users: ["Playlist A",
        "Playlist B"], type: "Playlist vs Playlist",
        score: 0.81, status: "ok" },
      { id: 2970, date: "2025-03-01", users: ["Team Alpha (5)"],
        type: "Group", score: 0.55, status: "err" },
      { id: 2955, date: "2025-02-26", users: ["Karis", "Mina"],
        type: "Me vs User", score: 0.90, status: "ok" },
      { id: 2948, date: "2025-02-24", users: ["Karis", "Leo"],
        type: "Me vs User", score: 0.71, status: "ok" },
    ];

    // --- State -------------------------------------------------------
    let q = "";
    let stat = "";
    let chip = "all";
    let page = 0;
    const size = 5;

    // --- DOM ---------------------------------------------------------
    const $ = (s) => document.querySelector(s);
    const rows = $("#rows");
    const count = $("#count");
    const empty = $("#empty");
    const drawer = $("#drawer");

    $("#q").addEventListener("input", (e) => {
      q = e.target.value.toLowerCase();
      page = 0; render();
    });
    $("#status").addEventListener("change", (e) => {
      stat = e.target.value;
      page = 0; render();
    });
    document.querySelectorAll(".chip").forEach(c => {
      c.addEventListener("click", () => {
        document.querySelectorAll(".chip")
          .forEach(x => x.classList.remove("active"));
        c.classList.add("active");
        chip = c.dataset.chip;
        page = 0; render();
      });
    });
    $("#prev").addEventListener("click", () => {
      page = Math.max(0, page - 1); render();
    });
    $("#next").addEventListener("click", () => {
      page = page + 1; render();
    });
    $("#closeDrawer").addEventListener("click", () => {
      drawer.classList.remove("open");
      drawer.setAttribute("aria-hidden", "true");
    });

    // --- Rendering ---------------------------------------------------
    function badge(cls, txt) {
      return `<span class="badge ${cls}">${txt}</span>`;
    }

    function fmtScore(n) {
      return (Math.round(n * 100) / 100).toFixed(2);
    }

    function applyFilters(data) {
      let out = data.slice();

      if (q) {
        out = out.filter(x =>
          x.users.join(" ").toLowerCase().includes(q) ||
          String(x.id).includes(q) ||
          x.type.toLowerCase().includes(q)
        );
      }
      if (stat) out = out.filter(x => x.status === stat);

      if (chip === "me")
        out = out.filter(x => x.type === "Me vs User");
      if (chip === "group")
        out = out.filter(x => x.type === "Group");
      if (chip === "playlist")
        out = out.filter(x =>
          x.type === "Playlist vs Playlist");
      if (chip === "high")
        out = out.filter(x => x.score >= 0.75);

      return out;
    }

    function render() {
      const filtered = applyFilters(mock);
      const start = page * size;
      const slice = filtered.slice(start, start + size);

      rows.innerHTML = "";
      if (slice.length === 0) {
        empty.style.display = "block";
      } else {
        empty.style.display = "none";
      }

      slice.forEach(x => {
        const scoreB = badge("score", fmtScore(x.score));
        const st = x.status === "ok" ? "ok" :
                   x.status === "warn" ? "warn" : "err";
        const row = document.createElement("tr");
        row.className = "row";
        row.innerHTML = `
          <td>${x.date}</td>
          <td>${x.users.join(" & ")}</td>
          <td>${x.type}</td>
          <td>${scoreB}</td>
          <td>${badge(st, x.status)}</td>
          <td>
            <div class="actions">
              <button class="mini view"
                data-id="${x.id}">View</button>
              <button class="mini rerun"
                data-id="${x.id}">Re-run</button>
              <button class="mini del"
                data-id="${x.id}">Delete</button>
            </div>
          </td>
        `;
        rows.appendChild(row);
      });

      count.textContent = `${filtered.length} results`;
      hookRowActions(slice);
    }

    function hookRowActions(slice) {
      document.querySelectorAll(".mini.view")
        .forEach(btn => {
          btn.addEventListener("click", () => {
            const id = Number(btn.dataset.id);
            const item = slice.find(x => x.id === id) ||
              mock.find(x => x.id === id);
            openDrawer(item);
          });
        });
      document.querySelectorAll(".mini.rerun")
        .forEach(btn => btn.addEventListener("click", () =>
          alert("Re-run comparison (stub)")));
      document.querySelectorAll(".mini.del")
        .forEach(btn => btn.addEventListener("click", () =>
          alert("Delete comparison (stub)")));
    }

    function openDrawer(item) {
      $("#pairId").textContent = `Pair #${item.id}`;
      $("#dDate").textContent = item.date;
      $("#dUsers").textContent = item.users.join(" & ");
      $("#dType").textContent = item.type;
      $("#dScore").textContent = fmtScore(item.score);
      $("#dStatus").textContent = item.status;
      drawer.classList.add("open");
      drawer.setAttribute("aria-hidden", "false");
    }

    // init
    render();
  </script>
</body>
</html>